!function(e){function t(e,t){for(var n=e.length,s=-1;++s<n&&t.call(e,e[s],s)!==!1;);return e}var n=function(){return"undefined"!=typeof setImmediate?setImmediate:"undefined"!=typeof process?process.nextTick:function(e){e&&setTimeout(e,0)}}(),s=function(e,t,r,a){var i=this;this.id=a||null,r=isNaN(r)||r===!0?0:r;var o=[],u=[],f=[];this.state=s.state.PENDING,this.value=null,e&&o.push(e),t&&f.push(t),this.reject=function(e){return i.state>s.state.PENDING?i:(i.state=s.state.FAILURE,d.apply(this,arguments),i)},this.resolve=function(e){return i.state>s.state.PENDING?i:(i.state=s.state.SUCCESS,d.apply(this,arguments),i)},this.promise=function(e){return i},this.always=function(e){return"function"==typeof e&&(i.state!==s.state.PENDING&&n(e.apply(this,i.value)),u.push(e)),i},this.done=function(e){return"function"==typeof e&&(i.state===s.state.SUCCESS&&n(e.apply(this,i.value)),o.push(e)),i},this.then=function(e,t){return i.done(e),i.fail(t),i},i.fail=function(e){return"function"==typeof e&&(i.state===s.state.FAILURE&&n(e.apply(this,i.value)),f.push(e)),i},this["catch"]=this.fail,this.isRejected=function(){return i.state===s.state.FAILURE},this.isResolved=function(){return i.state===s.state.SUCCESS},this.status=function(){var e=i.state,t=s.status[e];return t};var c=!0,d=function(e){if(i.state===s.state.PENDING)return i;i.value=arguments;var t=function(e,t,n){var r=0;try{var a=e.length;for(r=0;a>r;r++)e[r].apply(t,n)}catch(o){console.warn("Deferred callback Failed for state - "+i.status()+": "+o.message),c&&(c=!1,i.state=s.state.FAILURE,d({errorType:"deferred_callback_error",error:o,message:"An Error occured in this function: "+e[r].toString()}))}};return i.state===s.state.SUCCESS?t(o,this,arguments):i.state===s.state.FAILURE&&t(f,this,arguments),t(u,this,arguments),i};r&&window.setTimeout(function(){i.state===s.state.PENDING&&i.reject({errorType:"deferred_timed_out"})},r)};s.state={PENDING:0,FAILURE:1,SUCCESS:2},s.status=["pending","rejected","resolved"],s.when=function(){var e,n=0,r=new s,a=[].slice.call(arguments),i=null;return a[0]instanceof Array&&(a=a[0]),"function"==typeof arguments[1]&&(i=arguments[1]),e=a.length,0===e?r.resolve(null):t(a,function(t){t.then(function(){++n!==e||r.isResolved()||(r.resolve.apply(this,a),i&&i.apply(this,a))},function(){r.isResolved()||(r.reject.apply(this,a),i&&i.apply(this,a))})}),r},"undefined"!=typeof exports?module.exports=s:"function"==typeof define&&define.amd?define("Deferred",[],function(){return s}):"function"==typeof define?define("Deferred",s):window.Deferred=s}(this),function(e){function t(e,t){return new n(e,t)}var n=function(e,n){var s=2e4,r="GET",a=5,i="application/x-www-form-urlencoded; charset=UTF-8",o="json",u="------multipartformboundary"+(new Date).getTime(),f=e.contentType&&-1!==e.contentType.indexOf("multipart")?!0:!1;e=e||{},n=n||0;var c=this,d=new Deferred,p=e.requestType,l=e.url,h=e.maxRetry||e.retry||a,y=new XMLHttpRequest,m=(e.dataType||o,"GET"===e.method||"POST"===e.method?e.method:r),v=e.async||!0,T="";if(e.data){if("object"==typeof e.data)for(var g in e.data){var w=g+"="+encodeURIComponent(e.data[g]);"GET"===m&&-1!==l.indexOf(w)||(T.length>0&&(T+="&"),T+=w)}else"string"==typeof e.data&&(T=e.data);T.length>0&&"GET"===m&&(l+=-1===l.indexOf("?")?"?":"&",l+=T)}var E=navigator.userAgent.toString(),x=-1!==E.indexOf("Trident")?!0:!1;if(x===!1&&(y.timeout=e.timeout?e.timeout:s),y.open(m,l,v),this.contentType=e.contentType?e.contentType:i,f&&(this.contentType+="; boundary="+u),(!e.headers||e.headers&&!e.headers["Content-Type"])&&y.setRequestHeader("Content-Type",this.contentType),e.headers){if("object"==typeof e.headers)for(var g in e.headers)y.setRequestHeader(g,e.headers[g]);e.headers["X-Requested-With"]||y.setRequestHeader("X-Requested-With","XMLHttpRequest")}this.statusCode=null,this.responseObj={};var S=e.responseType||e.dataType||o,N=!1;this.done=d.done,this.success=this.done,this.fail=d.fail,this.always=d.always,e.error&&this.fail(e.error),e.success&&this.done(e.success),e.complete&&this.always(e.complete);var R=function(e,t){var n=I(),s=e;switch(c.statusCode=t.status,S){case"json":try{"string"==typeof e?(e=e.replace(/(\r\n|\n|\r)/gm,""),s=JSON.parse(e)):s=e}catch(r){var a="string"==typeof r?r:JSON.stringify(r);log.warn(a+" ---- fnAjax JSON.parse Fail: "+e),s=e}break;default:s=e}d.resolve(s,t,n,p||l)},j=function(e,t){N||(c.statusCode=y.status,N=!0,d.reject(t,p,y))},I=function(){for(var e={},t=y.getAllResponseHeaders().split("\n"),n=t.length,s=0;n>s;s++)if(t[s].length>0){var r=t[s].indexOf(":");if(r>0){var a=t[s].substring(0,r),i=t[s].substring(r+1).trim();e[a]=i}}return e};if(y.onreadystatechange=function(){if(4===y.readyState&&200===y.status)c.responseObj={url:l,status:y.status,responseText:y.responseText,requestType:p},R(y.responseText,y);else if(200!==y.status&&0!==y.status){var t=null;switch(y.status){case 404:t="NotFound";break;default:t="unknown"}j({},{errorType:t,status:y.status,requestType:p,requestParams:e})}},y.ontimeout=function(s){h>=n?(n++,e.timeout=y.timeout+1e3*n,t(e,n).fail(function(e){j(s,{errorType:"xhrTimeout"})}).done(function(e){R(e,y)})):j(s,{errorType:"xhrTimeout"})},y.onabort=function(e){j(e,{errorType:"xhrAbort"})},y.onerror=function(t){j(t,{errorType:"xhrError",status:y.status,requestType:p,requestParams:e})},f){console.warn("FN_Ajax multipart is not complete. It may or may not function.");var C=null,b=e.data.file;C=""==b.type?"application/octet-stream":b.type;var D=new FormData(e.data.form);y.send(D)}else if("GET"===m)y.send(null);else{var q=T.length>0?T:null;y.send(q)}return this};"undefined"!=typeof exports?module.exports=t:"function"==typeof define&&define.amd?define("ajax",[],function(){return t}):"function"==typeof define?define("ajax",t):window.ajax=t}(this);